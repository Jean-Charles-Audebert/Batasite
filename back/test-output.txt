
> back@1.0.0 test
> jest --forceExit

PASS src/tests/validators.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ­ƒöÉ encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/content.model.test.js
  ÔùÅ Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS src/tests/auth.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ÔÜÖ´©Å  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

FAIL src/tests/admin.model.test.js
  ÔùÅ Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS src/tests/admin.write.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ­ƒöÉ encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ­ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Database config: {
        user: 'batadmin',
        host: 'localhost',
        port: 5434,
        database: 'batasite'
      }

      at Object.log (src/config/db.js:12:9)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ÔÜÖ´©Å  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 65,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 11,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 126,
        email: 'admin-write-1765276004133@example.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.317Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 3,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin logged in: admin-write-1765276004133@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 1,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 129,
        email: 'target-admin-1765276004395@example.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.442Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin 129 updated by: admin-write-1765276004133@example.com (role: undefined, is_active: false)

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin 129 updated by: admin-write-1765276004133@example.com (role: superadmin, is_active: undefined)

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 5,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 132,
        email: 'temp-admin-1765276004533@example.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.586Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin 132 (temp-admin-1765276004533@example.com) deleted by: admin-write-1765276004133@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

FAIL src/tests/content.controller.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ÔÜÖ´©Å  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ­ƒöæ add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Database config: {
        user: 'batadmin',
        host: 'localhost',
        port: 5434,
        database: 'batasite'
      }

      at Object.log (src/config/db.js:12:9)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ÔÜÖ´©Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id',
        duration: 57,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO content (content, updated_by) VALUES ($1, $2)',
        duration: 5,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, content, updated_at FROM content ORDER BY id DESC LIMIT 1',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: { queryText: 'DELETE FROM content', duration: 5, rows: 1 }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, content, updated_at FROM content ORDER BY id DESC LIMIT 1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO content (content) VALUES ($1) RETURNING id, content, updated_at',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: { queryText: 'DELETE FROM content', duration: 7, rows: 1 }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.<anonymous> (C:\Workspaces\Perso\Batasite\back\src\tests\content.controller.test.js:93:7) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.<anonymous> (src/tests/content.controller.test.js:93:7)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM content ORDER BY id DESC LIMIT 1',
        duration: 20,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.updateContent (src/models/content.model.js:52:23)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      [ERROR] Error updating content: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

       7 |   },
       8 |   error: (message, error) => {
    >  9 |     console.error(`[ERROR] ${message}`, error || '');
         |             ^
      10 |   },
      11 |   warn: (message, data) => {
      12 |     console.warn(`[WARN] ${message}`, data || '');

      at Object.error (src/utils/logger.js:9:13)
      at Object.error [as updateContent] (src/models/content.model.js:70:9)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      Error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation',
        status: 500
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/content.controller.js:48:5)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM content ORDER BY id DESC LIMIT 1',
        duration: 25,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.updateContent (src/models/content.model.js:52:23)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      [ERROR] Error updating content: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

       7 |   },
       8 |   error: (message, error) => {
    >  9 |     console.error(`[ERROR] ${message}`, error || '');
         |             ^
      10 |   },
      11 |   warn: (message, data) => {
      12 |     console.warn(`[WARN] ${message}`, data || '');

      at Object.error (src/utils/logger.js:9:13)
      at Object.error [as updateContent] (src/models/content.model.js:70:9)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      Error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation',
        status: 500
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/content.controller.js:48:5)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM content ORDER BY id DESC LIMIT 1',
        duration: 20,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.updateContent (src/models/content.model.js:52:23)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      [ERROR] Error updating content: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

       7 |   },
       8 |   error: (message, error) => {
    >  9 |     console.error(`[ERROR] ${message}`, error || '');
         |             ^
      10 |   },
      11 |   warn: (message, data) => {
      12 |     console.warn(`[WARN] ${message}`, data || '');

      at Object.error (src/utils/logger.js:9:13)
      at Object.error [as updateContent] (src/models/content.model.js:70:9)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      Error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation',
        status: 500
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/content.controller.js:48:5)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM content ORDER BY id DESC LIMIT 1',
        duration: 16,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.updateContent (src/models/content.model.js:52:23)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      [ERROR] Error updating content: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

       7 |   },
       8 |   error: (message, error) => {
    >  9 |     console.error(`[ERROR] ${message}`, error || '');
         |             ^
      10 |   },
      11 |   warn: (message, data) => {
      12 |     console.warn(`[WARN] ${message}`, data || '');

      at Object.error (src/utils/logger.js:9:13)
      at Object.error [as updateContent] (src/models/content.model.js:70:9)
      at updateContent (src/controllers/content.controller.js:42:28)

    console.error
      Error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.updateContent (C:\Workspaces\Perso\Batasite\back\src\models\content.model.js:52:23)
          at updateContent (C:\Workspaces\Perso\Batasite\back\src\controllers\content.controller.js:42:28) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation',
        status: 500
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/content.controller.js:48:5)

    console.log
      Query executed: { queryText: 'DELETE FROM content', duration: 32, rows: 0 }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.<anonymous> (C:\Workspaces\Perso\Batasite\back\src\tests\content.controller.test.js:192:7) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.<anonymous> (src/tests/content.controller.test.js:192:7)

    console.log
      Query executed: { queryText: 'DELETE FROM content', duration: 17, rows: 0 }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.<anonymous> (C:\Workspaces\Perso\Batasite\back\src\tests\content.controller.test.js:212:7) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.<anonymous> (src/tests/content.controller.test.js:212:7)

    console.log
      Query executed: {
        queryText: 'SELECT c.id, c.content, c.updated_at, a.email \n' +
          '       FROM content c\n' +
          '       LEFT JOIN admins a ON c.updated_by = a.id\n' +
          '       ORDER BY c.updated_at DESC\n' +
          '       LIMIT $1',
        duration: 22,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content history retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: { queryText: 'DELETE FROM content', duration: 2, rows: 0 }

      at log (src/config/db.js:36:13)

    console.error
      Database error: error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"
          at C:\Workspaces\Perso\Batasite\back\node_modules\pg-pool\index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at query (C:\Workspaces\Perso\Batasite\back\src\config\db.js:34:17)
          at Object.<anonymous> (C:\Workspaces\Perso\Batasite\back\src\tests\content.controller.test.js:259:7) {
        length: 262,
        severity: 'ERROR',
        code: '23503',
        detail: 'Key (updated_by)=(125) is not present in table "admins".',
        hint: undefined,
        position: undefined,
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: 'public',
        table: 'content',
        column: undefined,
        dataType: undefined,
        constraint: 'content_updated_by_fkey',
        file: 'ri_triggers.c',
        line: '2608',
        routine: 'ri_ReportViolation'
      }

      37 |     return res;
      38 |   } catch (error) {
    > 39 |     console.error('Database error:', error);
         |             ^
      40 |     throw error;
      41 |   }
      42 | };

      at error (src/config/db.js:39:13)
      at Object.<anonymous> (src/tests/content.controller.test.js:259:7)

    console.log
      Query executed: {
        queryText: 'SELECT c.id, c.content, c.updated_at, a.email \n' +
          '       FROM content c\n' +
          '       LEFT JOIN admins a ON c.updated_by = a.id\n' +
          '       ORDER BY c.updated_at DESC\n' +
          '       LIMIT $1',
        duration: 39,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content history retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT c.id, c.content, c.updated_at, a.email \n' +
          '       FROM content c\n' +
          '       LEFT JOIN admins a ON c.updated_by = a.id\n' +
          '       ORDER BY c.updated_at DESC\n' +
          '       LIMIT $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content history retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT c.id, c.content, c.updated_at, a.email \n' +
          '       FROM content c\n' +
          '       LEFT JOIN admins a ON c.updated_by = a.id\n' +
          '       ORDER BY c.updated_at DESC\n' +
          '       LIMIT $1',
        duration: 3,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Content history retrieved by: content-test@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'DELETE FROM content WHERE updated_by = $1',
        duration: 11,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: { queryText: 'DELETE FROM admins WHERE id = $1', duration: 1, rows: 0 }

      at log (src/config/db.js:36:13)

  ÔùÅ Content Management API ÔÇ║ GET /content - Retrieval ÔÇ║ should return JSONB content correctly

    error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"

      32 |   const start = Date.now();
      33 |   try {
    > 34 |     const res = await pool.query(queryText, values);
         |                 ^
      35 |     const duration = Date.now() - start;
      36 |     console.log('Query executed:', { queryText, duration, rows: res.rowCount });
      37 |     return res;

      at node_modules/pg-pool/index.js:45:11
      at query (src/config/db.js:34:17)
      at Object.<anonymous> (src/tests/content.controller.test.js:93:7)

  ÔùÅ Content Management API ÔÇ║ PUT /content - Full Update ÔÇ║ should update content and return 200

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      114 |         .send({ data: newData });
      115 |
    > 116 |       expect(response.status).toBe(200);
          |                               ^
      117 |       expect(response.body).toHaveProperty('content');
      118 |       expect(response.body.content).toEqual(newData);
      119 |     });

      at Object.toBe (src/tests/content.controller.test.js:116:31)

  ÔùÅ Content Management API ÔÇ║ PUT /content - Full Update ÔÇ║ should set updated_by to authenticated admin

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      127 |         .send({ data: newData });
      128 |
    > 129 |       expect(response.status).toBe(200);
          |                               ^
      130 |       expect(response.body.updated_by).toBe(adminId);
      131 |     });
      132 |

      at Object.toBe (src/tests/content.controller.test.js:129:31)

  ÔùÅ Content Management API ÔÇ║ PUT /content - Full Update ÔÇ║ should update updated_at timestamp

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      138 |         .send({ data: { version: 1 } });
      139 |
    > 140 |       expect(response1.status).toBe(200);
          |                                ^
      141 |       const firstUpdate = new Date(response1.body.updated_at).getTime();
      142 |
      143 |       // Wait a tiny bit and update again

      at Object.toBe (src/tests/content.controller.test.js:140:32)

  ÔùÅ Content Management API ÔÇ║ PUT /content - Full Update ÔÇ║ should accept empty object

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      180 |         .send({ data: {} });
      181 |
    > 182 |       expect(response.status).toBe(200);
          |                               ^
      183 |       expect(response.body.content).toEqual({});
      184 |     });
      185 |   });

      at Object.toBe (src/tests/content.controller.test.js:182:31)

  ÔùÅ Content Management API ÔÇ║ PATCH /content - Partial Update ÔÇ║ should merge partial data with existing content

    error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"

      32 |   const start = Date.now();
      33 |   try {
    > 34 |     const res = await pool.query(queryText, values);
         |                 ^
      35 |     const duration = Date.now() - start;
      36 |     console.log('Query executed:', { queryText, duration, rows: res.rowCount });
      37 |     return res;

      at node_modules/pg-pool/index.js:45:11
      at query (src/config/db.js:34:17)
      at Object.<anonymous> (src/tests/content.controller.test.js:192:7)

  ÔùÅ Content Management API ÔÇ║ PATCH /content - Partial Update ÔÇ║ should not overwrite missing fields

    error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"

      32 |   const start = Date.now();
      33 |   try {
    > 34 |     const res = await pool.query(queryText, values);
         |                 ^
      35 |     const duration = Date.now() - start;
      36 |     console.log('Query executed:', { queryText, duration, rows: res.rowCount });
      37 |     return res;

      at node_modules/pg-pool/index.js:45:11
      at query (src/config/db.js:34:17)
      at Object.<anonymous> (src/tests/content.controller.test.js:212:7)

  ÔùÅ Content Management API ÔÇ║ GET /content/history - Content History ÔÇ║ should include id, content, updated_at, email

    error: insert or update on table "content" violates foreign key constraint "content_updated_by_fkey"

      32 |   const start = Date.now();
      33 |   try {
    > 34 |     const res = await pool.query(queryText, values);
         |                 ^
      35 |     const duration = Date.now() - start;
      36 |     console.log('Query executed:', { queryText, duration, rows: res.rowCount });
      37 |     return res;

      at node_modules/pg-pool/index.js:45:11
      at query (src/config/db.js:34:17)
      at Object.<anonymous> (src/tests/content.controller.test.js:259:7)

FAIL src/tests/admin.controller.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ÔÜÖ´©Å  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ÔÜÖ´©Å  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Database config: {
        user: 'batadmin',
        host: 'localhost',
        port: 5434,
        database: 'batasite'
      }

      at Object.log (src/config/db.js:12:9)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ­ƒöÉ encrypt with Dotenvx: https://dotenvx.com

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 59,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 6,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 130,
        email: 'admin-1765276004274@example.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.456Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 3,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin logged in: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 3,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 133,
        email: 'test-admin-1765276004534@example.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.587Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin list retrieved by: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin list retrieved by: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin list retrieved by: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin list retrieved by: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin 130 activity retrieved by: admin-1765276004274@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  ÔùÅ Admin Management API ÔÇ║ GET /admin/:id - Fetch single admin ÔÇ║ should return admin by ID (200)

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      104 |         .set('Authorization', `Bearer ${authToken}`);
      105 |
    > 106 |       expect(response.status).toBe(200);
          |                               ^
      107 |       expect(response.body.id).toBe(testAdminId);
      108 |     });
      109 |

      at Object.toBe (src/tests/admin.controller.test.js:106:31)

  ÔùÅ Admin Management API ÔÇ║ GET /admin/:id - Fetch single admin ÔÇ║ should return id, email, role, is_active (no password)

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

      113 |         .set('Authorization', `Bearer ${authToken}`);
      114 |
    > 115 |       expect(response.status).toBe(200);
          |                               ^
      116 |       expect(response.body).toHaveProperty('id');
      117 |       expect(response.body).toHaveProperty('email');
      118 |       expect(response.body).toHaveProperty('role');

      at Object.toBe (src/tests/admin.controller.test.js:115:31)

PASS src/tests/auth.controller.test.js
  ÔùÅ Console

    console.log
      [dotenv@17.2.3] injecting env (16) from .env -- tip: ­ƒöä add secrets lifecycle management: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ÔÜÖ´©Å  write to custom object with { processEnv: myObject }

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Database config: {
        user: 'batadmin',
        host: 'localhost',
        port: 5434,
        database: 'batasite'
      }

      at Object.log (src/config/db.js:12:9)

    console.log
      [dotenv@17.2.3] injecting env (0) from .env -- tip: ­ƒùé´©Å backup and recover secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

    console.log
      Initializing database...

      at Object.log [as initDb] (src/config/db.js:49:13)

    console.log
      Query executed: {
        queryText: '\n' +
          '      CREATE TABLE IF NOT EXISTS admins (\n' +
          '        id SERIAL PRIMARY KEY,\n' +
          '        email VARCHAR(255) UNIQUE NOT NULL,\n' +
          '        password_hash VARCHAR(255) NOT NULL,\n' +
          "        role VARCHAR(50) DEFAULT 'admin' CHECK(role IN ('admin', 'superadmin')),\n" +
          '        is_active BOOLEAN DEFAULT true,\n' +
          '        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
          '        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n' +
          '      )\n' +
          '    ',
        duration: 58,
        rows: null
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: '\n' +
          '      CREATE TABLE IF NOT EXISTS content (\n' +
          '        id SERIAL PRIMARY KEY,\n' +
          "        content JSONB NOT NULL DEFAULT '{}',\n" +
          '        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
          '        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n' +
          '        updated_by INTEGER REFERENCES admins(id) ON DELETE SET NULL\n' +
          '      )\n' +
          '    ',
        duration: 2,
        rows: null
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: '\n' +
          '      CREATE INDEX IF NOT EXISTS idx_content_updated_at ON content(updated_at DESC)\n' +
          '    ',
        duration: 4,
        rows: null
      }

      at log (src/config/db.js:36:13)

    console.log
      Database initialized successfully

      at Object.log [as initDb] (src/config/db.js:80:13)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 5,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 8,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 127,
        email: 'admin-1765276004219@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.326Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.error
      Error: Error: "email" must be a valid email
          at Object.createAdmin (C:\Workspaces\Perso\Batasite\back\src\models\admin.model.js:17:17)
          at createAdmin (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:14:36)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:22:14)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 6,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 128,
        email: 'duplicate-1765276004379@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.429Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 2,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.error
      [ERROR] Error creating admin: Error: Email already exists
          at Object.createAdmin (C:\Workspaces\Perso\Batasite\back\src\models\admin.model.js:26:19)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at register (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:14:19) {
        status: 409
      }

       7 |   },
       8 |   error: (message, error) => {
    >  9 |     console.error(`[ERROR] ${message}`, error || '');
         |             ^
      10 |   },
      11 |   warn: (message, data) => {
      12 |     console.warn(`[WARN] ${message}`, data || '');

      at Object.error (src/utils/logger.js:9:13)
      at Object.error [as createAdmin] (src/models/admin.model.js:50:9)
      at register (src/controllers/auth.controller.js:14:19)

    console.error
      Error: Error: Email already exists
          at Object.createAdmin (C:\Workspaces\Perso\Batasite\back\src\models\admin.model.js:26:19)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at register (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:14:19) {
        status: 409
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:22:14)

    console.error
      Error: Error: "email" is required
          at Object.createAdmin (C:\Workspaces\Perso\Batasite\back\src\models\admin.model.js:17:17)
          at createAdmin (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:14:36)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:22:14)

    console.error
      Error: Error: "password" is required
          at Object.createAdmin (C:\Workspaces\Perso\Batasite\back\src\models\admin.model.js:17:17)
          at createAdmin (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:14:36)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:22:14)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 5,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 131,
        email: 'login-1765276004474@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.522Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 8,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin logged in: login-1765276004474@test.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.error
      Error: Error: Invalid credentials
          at login (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:47:19)
          at processTicksAndRejections (node:internal/process/task_queues:105:5) {
        status: 401
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:49:14)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 8,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 134,
        email: 'inactive-1765276004611@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.661Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 6,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.error
      Error: Error: Account is inactive
          at login (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:54:19)
          at processTicksAndRejections (node:internal/process/task_queues:105:5) {
        status: 403
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:56:14)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 1,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 5,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 135,
        email: 'wrongpass-1765276004699@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.745Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 2,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.error
      Error: Error: Invalid credentials
          at login (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:62:19) {
        status: 401
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:64:14)

    console.error
      Error: Error: "email" is required
          at login (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:37:19)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:39:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at next (src/server.js:20:3)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:43:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:58:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.error
      Error: Error: "password" is required
          at login (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:37:19)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:39:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at next (src/server.js:20:3)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:43:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:58:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 2,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 4,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 136,
        email: 'refresh-1765276004826@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.872Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 2,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin logged in: refresh-1765276004826@test.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, role, is_active, created_at, updated_at FROM admins WHERE id = $1',
        duration: 3,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Token refreshed for admin: refresh-1765276004826@test.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.error
      Error: Error: Invalid or expired token
          at refresh (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:112:19)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 401
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:114:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at next (src/server.js:20:3)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:43:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:58:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.error
      Error: Error: Refresh token is required
          at refresh (C:\Workspaces\Perso\Batasite\back\src\controllers\auth.controller.js:104:19)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:157:13)
          at Route.dispatch (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\route.js:117:3)
          at handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:435:11)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:295:15
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at router.handle (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:186:3)
          at router (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:60:12)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at next (C:\Workspaces\Perso\Batasite\back\src\server.js:20:3)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at read (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:43:5)
          at urlencodedParser (C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\types\urlencoded.js:58:5)
          at Layer.handleRequest (C:\Workspaces\Perso\Batasite\back\node_modules\router\lib\layer.js:152:17)
          at trimPrefix (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:342:13)
          at C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:297:9
          at processParams (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:582:12)
          at next (C:\Workspaces\Perso\Batasite\back\node_modules\router\index.js:291:5)
          at C:\Workspaces\Perso\Batasite\back\node_modules\body-parser\lib\read.js:172:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:238:16)
          at done (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:227:7)
          at IncomingMessage.onEnd (C:\Workspaces\Perso\Batasite\back\node_modules\raw-body\index.js:287:7)
          at IncomingMessage.emit (node:events:508:28)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21) {
        status: 400
      }

      38 | // Error handler
      39 | app.use((err, req, res, next) => {
    > 40 |   console.error('Error:', err);
         |           ^
      41 |   res.status(err.status || 500).json({
      42 |     error: err.message || 'Internal Server Error',
      43 |     ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),

      at error (src/server.js:40:11)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at next (src/controllers/auth.controller.js:106:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at router.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at next (src/server.js:20:3)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:43:5)
      at urlencodedParser (node_modules/body-parser/lib/types/urlencoded.js:58:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:172:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

    console.log
      Query executed: {
        queryText: 'SELECT id FROM admins WHERE email = $1',
        duration: 1,
        rows: 0
      }

      at log (src/config/db.js:36:13)

    console.log
      Query executed: {
        queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
        duration: 3,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin created: {
        id: 137,
        email: 'logout-1765276004954@test.com',
        role: 'admin',
        is_active: true,
        created_at: 2025-12-09T09:26:44.995Z
      }

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Query executed: {
        queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
        duration: 2,
        rows: 1
      }

      at log (src/config/db.js:36:13)

    console.log
      [INFO] Admin logged in: logout-1765276004954@test.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      [INFO] Admin logged out: logout-1765276004954@test.com

      at Object.log [as info] (src/utils/logger.js:6:13)

    console.log
      Database pool closed

      at Object.log [as closePool] (src/config/db.js:107:13)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.

Test Suites: 4 failed, 1 skipped, 4 passed, 8 of 9 total
Tests:       10 failed, 4 skipped, 79 passed, 93 total
Snapshots:   0 total
Time:        3.665 s, estimated 5 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
