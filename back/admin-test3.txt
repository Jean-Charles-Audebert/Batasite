
> back@1.0.0 test
> jest --forceExit admin.controller.test.js

  console.log
    [dotenv@17.2.3] injecting env (16) from .env -- tip: ­ƒôí add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ­ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    Database config: {
      user: 'batadmin',
      host: 'localhost',
      port: 5434,
      database: 'batasite'
    }

      at Object.log (src/config/db.js:12:9)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ÔÜÖ´©Å  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    Query executed: {
      queryText: 'SELECT id FROM admins WHERE email = $1',
      duration: 30,
      rows: 0
    }

      at log (src/config/db.js:36:13)

  console.log
    Query executed: {
      queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
      duration: 5,
      rows: 1
    }

      at log (src/config/db.js:36:13)

  console.log
    [INFO] Admin created: {
      id: 68,
      email: 'admin-1765275713230@example.com',
      role: 'admin',
      is_active: true,
      created_at: 2025-12-09T09:21:53.323Z
    }

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    Query executed: {
      queryText: 'SELECT id, email, password_hash, role, is_active FROM admins WHERE email = $1',
      duration: 1,
      rows: 1
    }

      at log (src/config/db.js:36:13)

  console.log
    [INFO] Admin logged in: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    Query executed: {
      queryText: 'SELECT id FROM admins WHERE email = $1',
      duration: 1,
      rows: 0
    }

      at log (src/config/db.js:36:13)

  console.log
    Query executed: {
      queryText: 'INSERT INTO admins (email, password_hash, role) VALUES ($1, $2, $3) RETURNING id, email, role, is_active, created_at',
      duration: 3,
      rows: 1
    }

      at log (src/config/db.js:36:13)

  console.log
    [INFO] Admin created: {
      id: 69,
      email: 'test-admin-1765275713370@example.com',
      role: 'admin',
      is_active: true,
      created_at: 2025-12-09T09:21:53.397Z
    }

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin list retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin list retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin list retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin 69 retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin 69 retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin list retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

  console.log
    [INFO] Admin 68 activity retrieved by: admin-1765275713230@example.com

      at Object.log [as info] (src/utils/logger.js:6:13)

FAIL src/tests/admin.controller.test.js
  Admin Management API
    GET /admin - List all admins
      ÔêÜ should return array of admins (200) (10 ms)
      ÔêÜ should return id, email, role, is_active (no password) (6 ms)
      ÔêÜ should return 401 without JWT (3 ms)
      ÔêÜ should return 401 with invalid JWT (3 ms)
      ├ù should filter by role if query param provided (7 ms)
    GET /admin/:id - Fetch single admin
      ÔêÜ should return admin by ID (200) (6 ms)
      ÔêÜ should return id, email, role, is_active (no password) (6 ms)
      ÔêÜ should return 404 for non-existent admin (5 ms)
      ÔêÜ should return 400 for invalid admin ID format (3 ms)
      ÔêÜ should return 401 without JWT (3 ms)
    GET /admin/:id/activity - Fetch admin activity
      ÔêÜ should return activity log for admin (11 ms)
      ÔêÜ should return 401 without JWT (3 ms)
      ÔêÜ should return 404 for non-existent admin (4 ms)

  ÔùÅ Admin Management API ÔÇ║ GET /admin - List all admins ÔÇ║ should filter by role if query param provided

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      94 |       expect(response.status).toBe(200);
      95 |       const hasSuper = response.body.some(a => a.role === 'superadmin');
    > 96 |       expect(hasSuper).toBe(true);
         |                        ^
      97 |     });
      98 |   });
      99 |

      at Object.toBe (src/tests/admin.controller.test.js:96:24)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 12 passed, 13 total
Snapshots:   0 total
Time:        0.995 s, estimated 2 s
Ran all test suites matching admin.controller.test.js.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
